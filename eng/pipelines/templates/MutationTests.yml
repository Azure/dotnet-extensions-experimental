parameters:
  - name: buildScript
    type: string
  - name: buildConfig
    type: string
  - name: repoLogPath
    type: string
  - name: repoTestResultsPath
    type: string

steps:
  # Debug
  # - pwsh: |
  #       Write-Host 'buildScript: ${{ parameters.buildScript }}'
  #       Write-Host 'buildConfig: ${{ parameters.buildConfig }}'
  #       Write-Host 'repoLogPath: ${{ parameters.repoLogPath }}'
  #       Write-Host 'repoTestResultsPath: ${{ parameters.repoTestResultsPath }}'
  #       Get-ChildItem env:* | Sort-Object Name  
  #   displayName: Debug

  - script: ${{ parameters.buildScript }}
            -restore
            /bl:${{ parameters.repoLogPath }}/restore.binlog
    displayName: Restore

  - script: ${{ parameters.buildScript }}
            -mutationTest 
            -configuration ${{ parameters.buildConfig }}
            -warnAsError 0
            /bl:${{ parameters.repoLogPath }}/mutationtests.binlog
    displayName: Mutation tests

  - task: PublishBuildArtifacts@1
    displayName: Publish Logs
    inputs:
      PathtoPublish: '${{ parameters.repoLogPath }}'
      PublishLocation: Container
      ArtifactName: '$(Agent.Os)_$(Agent.JobName)'
    continueOnError: true
    condition: always()

  - task: PublishBuildArtifacts@1
    displayName: Publish Test Results
    inputs:
      PathtoPublish: '${{ parameters.repoTestResultsPath }}'
      PublishLocation: Container
      ArtifactName: '$(Agent.Os)_$(Agent.JobName)'
    continueOnError: true
    condition: always()
